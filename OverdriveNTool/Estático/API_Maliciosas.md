# **API Maliciosas**
---

Joder esto va a ser super divertido (>o<), tanto en el archivo Pecheck.txt como en la carpeta API se recogen
todas las llamadas a la API de Windows obtenidas con la herramienta Pecheck, aquí voy a indicar cuales de esas
son de uso común por los desarrolladores de malware y una breve descripción de que hacen, pero esto no quiere decir que estén siendo usadas con fines maliciosos. **¿EMPESAMOS? >:)**

---

| File Name | Hash SHA-256 |
| --------- | ------------ |
| OverdriveNTool.exe |ad1c82b1ba7df42a977f0c18275e368174187977882e82b1deec6d33c55357a3 |

---

**[ advapi32.dll.AdjustTokenPrivileges ]**

- Se utiliza para permitir o bloquear determinados privilegios específicos de acceso. Las muestras de malware
que se inyectan en proceso suelen llamar a esta función para obtener permisos adicionales.

**[ gdi32.dll.BitBlt ]**

- Realiza una transferencia bit-block del color correspondiente a un rectángulo de píxeles del dispositivo fuente especificado.
Utilizada para copiar datos gráficos de un dispositivo a otro. Hay muestras de spyware que utilizan esta función para realizar
capturas de pantalla. Esta función suele ser añadida por el compilador como parte del codigo de la librería.

**[ user32.dll.CallNextHookEx ]**

- Utilizada por código que está hookeándose en un evento establecido por SetWindowsHookEx. Llama al siguiente hook en la cadena.
Analiza la funcion que la llama para determinar el propósito del hook establecido por SetWindowsHookEx.

**[ Crypt32.dll.CertOpenSystemStore ]**

- Utilizada para acceder a los certificados almacenados en el sistema local.

**[ ole32.dll.CoCreateInstance ]**

- Crea un objeto COM. Los objetos COM permiten una gran cantidad de opciones. El identificador de clase CLSID indica que el
fichero contiene código que implementa el objeto COM.

**[ kernel32.dll.CreateFile ]**

- Crea un nuevo fichero o abre uno existente.

**[ kernel32.dll.CreateMutex ]**

- Crea un objeto de exclusión mutua (mutex) que puede ser utilizado por el malware para asegurar que solo una única instancia del 
malware se está ejecutando en un momento dado. Es frecuente que el nombre del mutex esté hardcodeado en el malware, lo que puede
ser usado como IOC (Indicador de compromiso).

**[ kernel32.dll.CreateProcess ]**

- Crea y lanza un nuevo proceso.

**[ kernel32.dll.DeviceIoControl ]**

- Envía un mensaje de control del espacio usuario al driver del dispositivo. Suele ser usada por los malware dev por ser un modo
fácil y flexible de pasar información entre el espacio usuario y el espacio del kernel. Para entender mejor esto debemos entender
que Windows en este caso, separa en memoria una parte para su uso del kernel y otra para el usuario, estas no deben mezclarse.

**[ kernel32.dll.FindFirstFile/indNextFile ]**

- Utilizada para buscar a través de un directorio y listar el sistema de ficheros.

**[ kernel32.dll.FindResource ]**

- Utilizada para encontrar un recurso en un ejecutable o librería cargada. En ocasiones, el malware emplea recursos para
almacenar cadenas, información de configuración u otros ficheros maliciosos. Como hemos detectado esta función debemos comprobar
la sección .rsrc en la cabecera PE del malware, esto lo podremos ver con IDA Pro, Ghidra, PEStudio o PeiD... ya lo veremos más
adelante (;

![ima](https://github.com/5kidRo0t/Malware_Analysis/assets/137389975/70a16493-64ee-4593-80aa-3ec2a7ccedb7)

**[ user32.dll.FindWindow ]**

- Busca una ventana abierta en el escritorio. En ocasiones, esta función se utiliza como técnica anti-debuggin para detectar
la presencia de un debugger, de hecho podemos encontrar la función IsDebuggerPresent en la carpeta API/kernel32.txt y Pecheck.txt
esto es un claro indicativo de que tenemos presentes técnicas anti-debugging que dificultan el análisis.

# **Hay más que ver aquí, pero estoy descansando... :)**
